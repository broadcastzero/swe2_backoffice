/*1330372243,169776066*/

if (window.CavalryLogger) { CavalryLogger.start_js(["caH\/n"]); }

__e("AvailableListConstants",[],function(a,b,c,d,e,f){var g={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};window.AvailableListConstants=e.exports=g;},3);
__e("ChatConfig",["copyProperties","ChatConfigInitialData"],function(a,b,c,d,e,f){var g=c('ChatConfigInitialData'),h=b('copyProperties'),i={},j=e.exports={get:function(k,l){return k in i?i[k]:l;},set:function(k){if(arguments.length>1){var l={};l[k]=arguments[1];k=l;}h(i,k);},getDebugInfo:function(){return i;}};j.set(g);},3);
__e("PresenceUtil",["Cookie","Env","math-extensions","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Env'),i=b('math-extensions'),j=b('tx'),k=i.rand32()+1;a.PresenceUtil=e.exports={checkMaintenanceError:function(l){if(l.getError()==1356007)return true;return false;},getErrorDescription:function(l){var m=l.getError(),n=l.getErrorDescription();if(!n)n="Ein Fehler ist aufgetreten.";if(m==1357001)n="Deine Sitzung ist abgelaufen. Bitte melde dich an.";return n;},getSessionID:function(){return k;},hasUserCookie:function(){return h.user===g.get('c_user');}};},3);
__e("presence-cookie-manager",["Cookie","Dcode","Env","JSLogger","json","PresenceUtil","URI","PresenceInitialData"],function(a,b,c,d,e,f){a.CookieManager=function(){};var g=b('Cookie'),h=b('Dcode'),i=b('Env'),j=b('JSLogger');b('json');var k=b('PresenceUtil'),l=b('URI'),m=c('PresenceInitialData'),n=m.cookieVersion,o=m.dictEncode,p='presence',q={},r=null,s=null,t=j.create('presence_cookie');function u(){try{var x=g.get(p);if(r!==x){r=x;s=null;if(x&&x.charAt(0)=='E')x=h.decode(x.substring(1));if(x)s=JSON.parse(x);}if(s&&(!s.user||s.user===i.user))return s;}catch(w){t.warn('getcookie_error');}return null;}function v(){return parseInt(new Date().getTime()/1000,10);}a.presenceCookieManager=e.exports={register:function(w,x){q[w]=x;},store:function(){var w=u();if(w&&w.v&&n<w.v)return;var x={v:n,time:v(),user:i.user};for(var y in q){var z=w&&w[y];x[y]=q[y](z);}var aa=JSON.stringify(x);if(o)aa='E'+h.encode(aa);if(k.hasUserCookie()){var ba=aa.length;if(ba>1024)t.warn('big_cookie',ba);var ca=l.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(p,aa,null,null,ca);}},clear:function(){g.clear(p);},getSubCookie:function(w){var x=u();if(!x)return null;return x[w];}};},3);
__e("PresenceState",["Arbiter","copyProperties","ErrorUtils","FunctionUtils","JSLogger","math-extensions","presence-cookie-manager","setIntervalAcrossTransitions","Util","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ErrorUtils'),j=b('FunctionUtils'),k=b('JSLogger'),l=b('math-extensions'),m=b('presence-cookie-manager'),n=b('setIntervalAcrossTransitions'),o=b('Util'),p=c('PresenceInitialData'),q=p.cookiePollInterval||2000,r=[],s=[],t=null,u=null,v=0,w=null,x=0,y=['sb2','t2','lm2','uct2','tr','tw'],z=k.create('presence_state');function aa(){return m.getSubCookie('state');}function ba(){v=Date.now();m.store();ea(u);}var ca=j.debounce(ba,0,false);function da(ia){var ja={};if(ia){y.forEach(function(ma){ja[ma]=ia[ma];});if(v<ia.ut)z.error('new_cookie',{cookie_time:ia.ut,local_time:v});}ja.ut=v;for(var ka=0,la=r.length;ka<la;ka++)i.applyWithGuard(r[ka],null,[ja]);u=ja;return u;}function ea(ia){x++;v=l.verifyNumber(ia.ut);if(!t)t=n(ha,q);u=ia;if(w===null)w=ia;for(var ja=0,ka=s.length;ja<ka;ja++)i.applyWithGuard(s[ja],null,[ia]);x--;}function fa(ia){if(ia&&ia.ut){if(v<ia.ut){return true;}else if(ia.ut<v)z.error('old_cookie',{cookie_time:ia.ut,local_time:v});}else z.error('no_cookie');return false;}function ga(){var ia=aa();if(fa(ia))u=ia;return u;}function ha(){var ia=aa();if(fa(ia))ea(ia);}m.register('state',da);g.subscribe(k.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:h({},w),state:h({},u),update_time:v,sync_paused:x,poll_time:q};});(function(){var ia=ga();if(ia){ea(ia);}else{z.debug('no_cookie_initial');ea(da());return;}})();a.PresenceState=e.exports={doSync:function(ia){if(x)return;if(ia){ba();}else ca();},registerStateStorer:function(ia){r.push(ia);},registerStateLoader:function(ia){s.push(ia);},get:function(){return ga();},getInitial:function(){return w;}};},3);
__e("presence-arbiter-message",[],function(a,b,c,d,e,f){a.PresenceMessage=e.exports={WINDOW_RESIZED:'presence/window-resized',TAB_CLOSED:'presence/tab-closed',TAB_OPENED:'presence/tab-opened',PRESENCE_UPDATER_READY:'presence/updater-ready',getAppMessageType:function(g,h){return 'presence/app_message:'+g+':'+h;},getArbiterMessageType:function(g){return 'presence/message:'+g;}};},3);
__e("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","presence-arbiter-message","PresenceUtil"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChannelConstants'),j=b('copyProperties'),k=b('Env'),l=b('JSLogger'),m=b('presence-arbiter-message'),n=b('PresenceUtil');if(a.PresencePrivacy){e.exports=a.PresencePrivacy;}else{var o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u={},v,w={},x,y,z,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=j(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==k.user){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){next=aa.shift();ia(next.request,next.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);j(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){next=aa.shift();ia(next.request,next.data);}}function na(qa,ra){if(n!=null){var sa=qa.getData();sa.window_id=n.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=k.user){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===n.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}j(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){v=x=qa;y=z=ra;u=j({},sa);w=j({},sa);ba=false;this.inform('initialized',this,g.BEHAVIOR_PERSISTENT);this.inform('privacy-changed');this.inform('privacy-user-presence-changed');ca().log('initialized',{visibility:qa,policy:ra});g.inform('chat-visibility/initialized',this,g.BEHAVIOR_PERSISTENT);g.subscribe(m.getArbiterMessageType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(ta,ua){var va=ua.getConfig('visibility',null);if(va!==null&&typeof(va)!=='undefined'){var wa=va?da.ONLINE:da.OFFLINE;ga(wa);ca().log('config_visibility',{vis:wa});}}.bind(this));g.subscribe('channel/visibility-config',function(ta,ua){var va=ua?da.ONLINE:da.OFFLINE;if(va!=v){ga(va);ca().log('config_visibility_old_channel',{vis:va});}}.bind(this));},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},allows:function(qa){if(this.getVisibility()===da.OFFLINE)return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});d(['PresencePrivacyInitialDataLoader'],function(qa){da.init.bind(da,qa.visibility,qa.onlinePolicy,qa.privacyData).defer();});a.PresencePrivacy=e.exports=da;}},3);
__e("Chat",["Arbiter","AsyncSignal","JSLogger","ObjectUtils","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('JSLogger'),j=b('ObjectUtils'),k=b('PresencePrivacy');function l(p,q){if(q&&q=='ordered_list'||q=='more_online_friends'||q=='online_friends'||q=='typeahead'){var r={target:p,source:q};new h('/ajax/chat/ct.php',r).send();}}var m={chatDisplay:'chat-display/loaded',buddyListDisplay:'buddylist-display/initialized',buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function n(p,q){g.subscribe(m[p],function(event,r){q(r);});}var o={openTab:function(p,q,r,s){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(p);l(p,s);d(['ChatConfig'],function(t){if(t.get('mercury_integration')){d(['MercuryThreads'],function(u){if(!r||r=='friend'){var v=u.getCanonicalThreadToUser(p);g.inform('chat/open-tab',{thread_id:v.thread_id});}});}else n('chatDisplay',function(u){u.focusTab(p,true,q,q,r);});});},openMultichatTab:function(p,q,r,s,t,u){n('chatDisplay',function(v){v.createMultichatTab(p,q,r,s,t,true,u);});},loadTabFragile:function(p,q,r,s){d(['ChatConfig'],function(t){if(t.get('mercury_integration')){d(['ChatController'],function(u){u.raiseFragileGroupTab(p);});}else n('chatDisplay',function(u){u.loadTabFragile(p,q,r,s);});});},openBuddyList:function(){n('buddyListNub',function(p){p.show();n('sidebar',function(q){q.enable();});});},closeBuddyList:function(){n('buddyListNub',function(p){p.hide();});},toggleSidebar:function(){n('sidebar',function(p){p.toggle();});},goOnline:function(p){d(['ChatVisibility'],function(q){q.goOnline(p);});},isOnline:function(){var p=null;d(['ChatVisibility'],function(q){p=q;});return p&&p.isOnline();},squelchTab:function(p,q){n('chatDisplay',function(r){r.setSquelchedTab(p,true);r.closeTab(p);});},unsquelchTab:function(p){n('chatDisplay',function(q){q.setSquelchedTab(p,false);});},getActiveChats:function(){if(!window.chatDisplay)return [];return j.getKeys(window.chatDisplay.tabs);},hasFocusedChat:function(){return window.chatDisplay&&window.chatDisplay.hasFocusedTab();},getActiveFriendChats:function(){var p=this.getActiveChats();return p.filter(function(q){return window.chatDisplay&&window.chatDisplay.tabs[q]&&window.chatDisplay.tabs[q].getPostType()=='friend';});},getLogger:function(p){return i.create(p);}};a.Chat=e.exports=o;},3);
function ChatOptions(a,b){this._jslog=JSLogger.create('chat_options');this._jslog.log('server',{vis:a});this.visibility=!!a;this._lastVisibilityChangeTime=0;this.settings=b;}copy_properties(ChatOptions.prototype,{load:function(){requireLazy(['ChatConfig','PresenceUtil','PresenceState','ChannelConstants','ChannelManager'],function(a,b,c,d,e){this._chatConfig=a;this._presenceState=c;c.registerStateStorer(this._storeState.bind(this));c.registerStateLoader(this._loadState.bind(this));if(!a.get('blackbird')){Arbiter.subscribe(d.ON_CONFIG,function(f,g){var h=e.getConfig('visibility');this._jslog.log('vis_chan_config',{new_vis:h});this.setVisibility(h);}.bind(this));Arbiter.subscribe('channel/visibility-config',function(f,g){this._jslog.log('vis_chan_config',{new_vis:g});this.setVisibility(g);}.bind(this));}Arbiter.subscribe(PresenceMessage.getArbiterMessageType('visibility'),function(f,g){var h=g.obj;if(h.window_id===b.getSessionID())return;this._jslog.log('vis_chan_message',{new_vis:h.visibility,window_id:h.window_id});this.setVisibility(h.visibility);}.bind(this));Arbiter.subscribe(PresenceMessage.getArbiterMessageType('setting'),function(f,g){var h=g.obj;if(h.window_id===b.getSessionID())return;this.setSetting(h.setting,!!h.value,'channel');}.bind(this));Arbiter.inform('chat-options/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);if(!a.get('blackbird')){this._jslog.log('define_vis_init',this.visibility);Arbiter.inform('chat-visibility/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);}}.bind(this));},_storeState:function(a){a.vis=this.visibility?1:0;a.vct=this._lastVisibilityChangeTime;a.bls=this.getSetting('sticky_buddylist')?1:0;a.blc=this.getSetting('compact_buddylist')?1:0;a.snd=this.getSetting('sound')?1:0;return a;},_loadState:function(a){if(!this._chatConfig.get('blackbird')){var b=verifyNumber(a.vct),c=Math.max(Env.rep_lag,this._chatConfig.get('presence_cookie_setting_cache_window'));if(new Date()-b<c&&this._lastVisibilityChangeTime<b){if(a.vis!=this.visibility){this._jslog.log('vis_load',{new_vis:a.vis});this.setVisibility(!!a.vis);}this._lastVisibilityChangeTime=b;}}this.setSetting('sticky_buddylist',!!a.bls,'cookie');this.setSetting('compact_buddylist',!!a.blc,'cookie');this.setSetting('sound',!!a.snd,'cookie');},setVisibility:function(a){if(a===this.visibility)return;this.visibility=a;this._lastVisibilityChangeTime=Date.now();Arbiter.inform('chat/visibility-changed',{sender:this});this._presenceState.doSync();},_onVisibilityResponse:function(a){this._jslog.log('vis_send_success',{new_vis:a});if(a)this.setVisibility(a);},_onVisibilityError:function(a){this._jslog.log('vis_send_error',{old_vis:a});this.setVisibility(a);},toggleVisibility:function(){this.sendVisibility(!this.visibility);},sendVisibility:function(a){requireLazy(['PresenceUtil'],function(b){this._jslog.log('vis_send',{old_vis:this.visibility,new_vis:a});if(this.visibility==a)return;var c={visibility:a,notify_ids:Chat.getActiveFriendChats(),window_id:b.getSessionID()};if(!a)this.setVisibility(a);new AsyncRequest('/ajax/chat/visibility.php').setHandler(this._onVisibilityResponse.shield(this,a)).setErrorHandler(this._onVisibilityError.shield(this,!a)).setData(c).setAllowCrossPageTransition(true).send();Arbiter.inform(a?'chat/connect':'chat/disconnect');}.bind(this));},getSetting:function(a){return this.settings[a];},setSetting:function(a,b,c){if(this.getSetting(a)==b)return;if(c){c='from_'+c;this._jslog.log(c,{name:a,new_value:b,old_value:this.getSetting(a)});}this.settings[a]=b;Arbiter.inform('chat/option-changed',{name:a,value:b});}});
__e("ChatVisibility",["Arbiter","ChatConfig","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('JSLogger'),j=b('PresencePrivacy'),k={isOnline:function(){if(h.get('blackbird'))return j.getVisibility()===j.ONLINE;return window.chatOptions&&window.chatOptions.visibility;},goOnline:function(l){if(h.get('blackbird')){j.subscribe('initialized',function(){if(j.getVisibility()===j.OFFLINE){i.create('blackbird').log('chat_go_online');j.setVisibility(j.ONLINE);}l&&l();});return;}g.subscribe('chat-options/initialized',function(event,m){if(m.visibility){l&&l();}else{if(l)var n=g.subscribe('chat/visibility-changed',function(){g.unsubscribe(n);l();});m.sendVisibility(true);}});},canGoOffline:function(){var l=g.inform('live_listen_chat/go_offline');if(l===false){i.create('music_live_listen').log('can_go_offline',false);return false;}return true;},goOffline:function(l){if(!this.canGoOffline())return;if(h.get('blackbird')){j.subscribe('initialized',function(){if(j.getVisibility()===j.ONLINE){i.create('blackbird').log('chat_go_offline');j.setVisibility(j.OFFLINE);}l&&l();});return;}g.subscribe('chat-options/initialized',function(event,m){if(m.visibility){if(l)var n=g.subscribe('chat/visibility-changed',function(){g.unsubscribe(n);l();});m.sendVisibility(false);}else l&&l();});},toggleVisibility:function(){if(k.isOnline()){k.goOffline();}else k.goOnline();}};a.ChatVisibility=e.exports=k;},3);
__e("ServerTime",["PresenceInitialData"],function(a,b,c,d,e,f){var g=c('PresenceInitialData'),h;function i(j){h=Date.now()-j;}i(g.serverTime);a.ServerTime=e.exports={get:function(){return Date.now()-h;},getSkew:function(){return h;},update:function(j){i(j);}};},3);
__e("ShortProfiles",["Arbiter","ArrayUtils","JSLogger","ObjectUtils","AsyncRequest","Env","ErrorUtils","Util","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArrayUtils'),i=b('JSLogger'),j=b('ObjectUtils'),k=b('AsyncRequest'),l=b('Env'),m=b('ErrorUtils'),n=b('Util'),o=b('copyProperties'),p={},q=new g(),r=[],s=false,t=false,u=i.create('short_profiles');function v(){if(!r.length||s)return;s=true;aa.defer();}function w(fa){var ga=[];h.createFrom(fa).forEach(function(ha){var ia={};for(var ja=0,ka=ha.ids.length;ja<ka;ja++){var la=ha.ids[ja];if(p[la]){ia[la]=p[la];}else{ia=null;break;}}if(ia){var ma={};for(var na in ia)ma[na]=o({},ia[na]);m.applyWithGuard(ha.fun,ha,[ma],function(oa){oa.profile_ids=ha.ids;});}else ga.push(ha);});return ga;}function x(){s=false;v();}var y='/ajax/chat/user_info.php',z='/ajax/chat/user_info_all.php';function aa(fa){q.inform('fetch');var ga=w(r);r=[];if(!ga.length){x();return;}var ha={};ga.forEach(function(ja){ja.ids.forEach(function(ka){if(!p[ka])ha[ka]=true;});});var ia=j.getKeys(ha);new k(y).setData({ids:ia}).setHandler(function(ja){ba(ja,ga);}).setErrorHandler(ca).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}function ba(fa,ga){for(var ha in fa.payload){var ia=fa.payload[ha];if(!ia.type)ia.type='friend';p[ha]=ia;}if(ga)w(ga);r=w(r);x();q.inform('updated');var ja=fa.getRequest().uri.getPath();if(ja==y){u.log('fetch_response');}else if(ja==z)u.log('fetch_response_all');}function ca(){u.error('fetch_error');x();}function da(){if(!t){u.log('fetch_all');t=true;new k(z).setData({viewer:l.user}).setHandler(ba).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}}var ea=o(q,{get:function(fa,ga){this.getMulti([fa],function(ha){ga(ha[fa],fa);});},getMulti:function(fa,ga){var ha={ids:fa,fun:ga},ia=w([ha]);if(ia.length){r.push(ha);v();}},getNow:function(fa){var ga=p[fa];if(ga)return o({},ga);return null;},getCachedProfileIDs:function(){return keys(p);},hasAll:function(){return t;},fetchAll:function(){da();},set:function(fa,ga){var ha=p[fa];if(ha&&(ha.name!=ga.name||ha.firstName!=ga.firstName||ha.thumbSrc!=ga.thumbSrc))u.warn('changed',{oldInfo:ha,newInfo:ga});p[fa]=o({},ga);},setMulti:function(fa){for(var ga in fa)this.set(ga,fa[ga]);}});d(['InitialChatUserInfosLoader'],function(fa){ea.setMulti(fa);});a.ShortProfiles=e.exports=ea;},3);
__e("AvailableList",["Arbiter","AsyncRequest","AvailableListConstants","ChannelConnection","ChannelConstants","Chat","ChatConfig","ChatVisibility","copyProperties","Env","isEmpty","JSLogger","ObjectUtils","Poller","PresencePrivacy","PresenceUtil","ServerTime","ShortProfiles","UserActivity","AvailableListInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChannelConstants'),l=b('Chat'),m=b('ChatConfig'),n=b('ChatVisibility'),o=b('copyProperties'),p=b('Env'),q=b('isEmpty'),r=b('JSLogger'),s=b('ObjectUtils'),t=b('Poller'),u=b('PresencePrivacy'),v=b('PresenceUtil'),w=b('ServerTime'),x=b('ShortProfiles'),y=b('UserActivity'),z=c('AvailableListInitialData'),aa=5,ba=60000,ca='/ajax/chat/buddy_list.php',da=5000,ea=1800000,fa=.005,ga=0,ha=0,ia=false,ja=z.pollInterval,ka=z.lazyPollInterval,la=z.lazyThreshold,ma=null,na=new Date(),oa=na,pa={},qa=false,ra={},sa=null,ta={},ua={},va=r.create('available_list'),wa=o(new g(),i);wa.subscribe([i.ON_AVAILABILITY_CHANGED,i.ON_UPDATE_ERROR,i.ON_UPDATED],function(ob,pb){g.inform(ob,pb);});function xa(ob){var pb=ob||y.isActive(la);return n.isOnline()?(pb?ja:ka):null;}function ya(ob,pb){var qb=null;switch(ob){case i.OFFLINE:qb='offline';break;case i.IDLE:qb='idle';break;case i.ACTIVE:qb='active';break;case i.MOBILE:qb='mobile';break;}va.rate(qb,pb);}function za(){ma=null;wa.inform(i.ON_AVAILABILITY_CHANGED);}function ab(ob,pb,qb,rb){if(ob==p.user)return;switch(pb){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return;}var sb=wa.get(ob)!=pb;if(qb){ta[ob]=w.get();ua[ob]=rb;}pa[ob]=pb;if(sb){ga++;if(!ma)ma=za.defer();ya(pb,qb);}}function bb(ob){oa=new Date();ra=Object.from(ob);}function cb(){if(wa.haveFullList)wa.inform(i.ON_UPDATED,wa);}function db(ob){if(v.checkMaintenanceError(ob))return;ha++;ia=false;if(ha>=aa)wa.inform(i.ON_UPDATE_ERROR);}function eb(ob){var pb=ob.getPayload(),qb=pb.buddy_list;if(!qb){db(ob);return;}w.update(pb.time);wa.updateTime=w.get();ha=0;ia=false;wa.haveFullList=true;if(qb.mobile_friends!=null)bb(qb.mobile_friends);var rb=qb.userInfos;if(rb)x.setMulti(rb);var sb=qb.nowAvailableList,tb=[];for(var ub in pa)if(wa.get(ub)!==wa.OFFLINE)tb.push(ub);tb.forEach(function(vb){ya(wa.OFFLINE,false);pa[vb]=wa.OFFLINE;});qa=qb.userIsIdle;sb&&wa.addLegacyAvailableList(sb);ta={};ua={};if(qb.newAvailableList){wa.presenceData=qb.newAvailableList;wa.haveFullList=true;}if(qb.chatNotif!==undefined){sa=qb.chatNotif;wa.inform(i.ON_CHAT_NOTIFICATION_CHANGED,sa);}jb();za();cb();}function fb(ob){if(j.isShutdown()||!n.isOnline()){wa._poller.stop();return;}na=new Date();var pb=false;if(new Date()-oa>ea)pb=true;ia=true;var qb=x.getCachedProfileIDs();ob.setHandler(eb).setErrorHandler(db).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:p.user,available_user_info_ids:qb,fetch_mobile:pb}).setURI(ca).setAllowCrossPageTransition(true);}function gb(ob){var pb=ob.payload.availability||{};for(var qb in pb)ab(qb,pb[qb],true,'mercury_tabs');}function hb(ob){var pb=new h('/ajax/mercury/tabs_presence.php').setData({target_id:ob}).setHandler(gb).setErrorHandler(bagofholding).setAllowCrossPageTransition(true).send();}function ib(ob,pb){for(var qb in ob){var rb,sb;if(pb){rb=i.legacyStatusMap[ob[qb].ol];sb=ob[qb].s;}else if(!ob[qb]){rb=i.OFFLINE;}else if(ob[qb].i){rb=i.IDLE;}else if(ob[qb].m){rb=i.MOBILE;}else rb=i.ACTIVE;ab(qb,rb,pb,sb);}}function jb(ob){var pb=xa(ob);va.debug('update_poller',pb);wa._poller&&wa._poller.setTimePeriod(pb);}function kb(){wa.haveFullList=false;na=0;oa=0;pa={};ua={};ta={};ra={};ga++;za();}function lb(){jb();if(n.isOnline()){wa.update();}else kb();}function mb(){jb();if(j.disconnected()){kb();}else if(!wa.haveFullList)wa.update();}function nb(ob,pb){pb.chat_config=m.getDebugInfo();pb.available_list_debug_info={};wa.getAvailableIDs().forEach(function(qb){pb.available_list_debug_info[qb]=wa.getDebugInfo(qb);});pb.available_list_poll_interval=wa._poller&&wa._poller.getTimePeriod();}o(wa,{haveFullList:false,get:function(ob){if(ob==p.user)return n.isOnline()?i.ACTIVE:i.OFFLINE;var pb=i.OFFLINE;if(ob in pa)pb=pa[ob];if(m&&m.get('blackbird')&&!u.allows(ob))pb=i.OFFLINE;if(pb==i.OFFLINE)if(ra[ob])pb=i.MOBILE;return pb;},updateForID:function(ob){hb(ob);},getWebChatNotification:function(){return sa;},isUserIdle:function(){return qa;},isReady:function(){return wa.haveFullList;},set:function(ob,pb,qb){ab(ob,pb,true,null,qb);},update:function(){if(new Date()-na<da){!ia&&cb.defer();return;}wa._poller&&wa._poller.requestNow();},getRev:function(){return ga;},isIdle:function(ob){return wa.get(ob)==i.IDLE;},getOnlineIDs:function(){var ob,pb=[];for(ob in pa)if(wa.get(ob)===i.ACTIVE)pb.push(ob);return pb;},getAvailableIDs:function(){var ob=wa.getOnlineIDs(),pb;for(pb in ra){if(pb in pa)continue;ob.push(pb);}return ob;},getOnlineCount:function(ob){if(ob&&!wa.haveFullList)return 0;return wa.getOnlineIDs().length;},addLegacyOverlay:function(ob){ib(ob,true);},addLegacyAvailableList:function(ob){ib(ob,false);},getDebugInfo:function(ob){var pb;if(window.ShortProfiles){var qb=x.getNow(ob);if(qb)pb=qb.name;}return {id:ob,presence:pa[ob],overlaySource:ua[ob],overlayTime:ta[ob],overlaySource:ua[ob],mobile:ra[ob],name:pb};}});wa.updateTime=z.updateTime;wa.addLegacyAvailableList(z.availableList);wa.haveFullList=true;if(z.mobileFriends)bb(z.mobileFriends);sa=z.chatNotif;wa._poller=new t(xa(),fb,true);g.subscribe('chat-visibility/initialized',function(ob){va.log('visibility_init',ob);jb(true);});g.subscribe(r.DUMP_EVENT,nb);y.subscribe(function(ob,pb){if(pb.idleness>ja){va.debug('update_activity');wa.update();}});if(m.get('blackbird')){u.subscribe('privacy-changed',za);u.subscribe('privacy-availability-changed',function(ob,pb){for(var qb in pb.user_availabilities)this.set(qb,pb.user_availabilities[qb]);}.bind(wa));u.subscribe('privacy-user-presence-response',wa.update);}else g.subscribe('chat/visibility-changed',lb);if(m.get('channel_disconnect_warning')){j.subscribe([j.CONNECTED,j.RECONNECTING,j.SHUTDOWN,j.MUTE_WARNING,j.UNMUTE_WARNING],mb);}else{j.subscribe(j.CONNECTED,wa.update);g.subscribe(k.ON_INVALID_HISTORY,wa.update);}a.AvailableList=e.exports=wa;});
var ChatQuietLinks={silence:function(a){if(ua.firefox()>=4||ua.chrome())var b=Event.listen(document,'mousemove',function(){this._removeLinkHrefs(a);b.remove();}.bind(this));},_removeLinkHrefs:function(a){var b=DOM.scry(a,'a');for(var c=0;c<b.length;c++){var d=b[c].getAttribute('href');if(!d||d.charAt(0)=='#')b[c].removeAttribute('href');}}};
__e("GroupChatController",["Arbiter","Chat","ChatConfig","ChatVisibility","DOM","css-core","PageTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Chat'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('DOM'),l=b('css-core'),m=b('PageTransitions');function n(o,p,q){_goOnlineText=k.find(o,'.fbGroupChatGoOnline');_chatWithGroupText=k.find(o,'.fbGroupChatOpenTab');function r(){if(j.isOnline()){l.hide(_goOnlineText);l.show(_chatWithGroupText);}else{l.hide(_chatWithGroupText);l.show(_goOnlineText);}}_visibilitySubscription=g.subscribe('chat/visibility-changed',r);m.registerHandler(g.unsubscribe.bind(g,_visibilitySubscription));Event.listen(o,'click',function(){if(i.get('mercury_integration')){d(['ChatController'],function(s){s.raiseGroupTab(p);});}else j.goOnline(function(){h.openTab(p,q,'group');});});}e.exports=n;});
__e("InitialChatUserInfosLoader",["InitialChatUserInfos"],function(a,b,c,d,e,f){e.exports=c('InitialChatUserInfos');});
__e("PresencePrivacyInitialDataLoader",["PresencePrivacyInitialData"],function(a,b,c,d,e,f){e.exports=c('PresencePrivacyInitialData');});
var ChatSidebar=window.ChatSidebar||(function(){var a=null,b=null,c=null,d=null,e,f=false,g=false,h=false,i=false,j,k,l,m,n,o,p=null,q=null,r=null,s=JSLogger.create('blackbird'),t=32;function u(ca){switch(ca){case d.HINT_AUTH:return "Deine Sitzung ist abgelaufen. Bitte melde dich an.";case d.HINT_CONN:return tx._("Facebook-{Chat} ist derzeit nicht verf\u00fcgbar.",{Chat:"Chat"});case d.HINT_MAINT:return tx._("Facebook-{Chat} ist derzeit aufgrund von Wartungsarbeiten nicht verf\u00fcgbar.",{Chat:"Chat"});default:return tx._("Facebook-{Chat} ist derzeit nicht verf\u00fcgbar.",{Chat:"Chat"});}}function v(ca){var da;if(ca===null){da="Verbindung zum Chat nicht m\u00f6glich. Pr\u00fcfe deine Internet-Verbindung.";}else if(ca>b.get('warning_countdown_threshold_msec')){var ea=$N('a',{href:'#',className:'fbChatReconnectLink'},"Versuche es erneut");da=DOM.tx._("Verbindung zum Chat nicht m\u00f6glich. {try-again-link}",{'try-again-link':ea});}else if(ca>1000){da=tx._("Verbindung zum Chat nicht m\u00f6glich. Die Verbindung wird in {seconds} Sekunden erneut hergestellt ...",{seconds:Math.floor(ca/1000)});}else da="Verbindung zum Chat nicht m\u00f6glich. Die Verbindung wird erneut hergestellt ...";return da;}function w(ca,da){if(q){clearTimeout(q);q=null;}if(ca===c.SHUTDOWN){p=u(da);}else if(ca===c.CONNECTED){p=null;}else if(ca===c.RECONNECTING){var ea=da;p=v(ea);if(ea>1000){if(ea>b.get('warning_countdown_threshold_msec')){if(r){r.remove();r=null;}r=Event.listen(k,'click',function(event){if(CSS.hasClass(event.getTarget(),'fbChatReconnectLink')){c.reconnect();return false;}});}q=setTimeout(bind(null,w,ca,ea-1000),1000,false);}}x();}function x(){var ca=ChatVisibility.isOnline(),da=false;CSS.removeClass(l,'error');CSS.removeClass(l,'notice');if(!ca){var ea='fbChatGoOnlineLink',fa=b.get('blackbird')?"Online gehen":"verf\u00fcgbar",ga=$N('a',{href:'#',className:ea},fa),ha=b.get('blackbird')?DOM.tx._("{=Go online}, um zu sehen, wer gerade zum Chatten online ist.",{'=Go online':ga}):DOM.tx._("Du bist im Chat nicht verf\u00fcgbar. M\u00f6chtest du f\u00fcr deine Freunde als {=available} angezeigt werden?",{'=available':ga});DOM.setContent(k,ha);Event.listen(k,'click',function(event){if(CSS.hasClass(event.getTarget(),ea)){if(ChatVisibility.isOnline()){s.error('sidebar_go_online_while_online');s.rate('sidebar_go_online_error',b.get('blackbird'));}s.rate('sidebar_go_online',b.get('blackbird'));ChatVisibility.goOnline();return false;}});CSS.addClass(l,'offline');}else{CSS.removeClass(l,'offline');DOM.empty(k);if(c.disconnected()){CSS.addClass(l,'error');DOM.setContent(k,p);}else if(b.get('mercury_integration')&&a&&!a.notifiesUserMessages()){CSS.addClass(l,'notice');DOM.setContent(k,"Alerts are off while you use another client to chat.");}}z();}function y(){if(!ChatSidebar.isVisible()&&i)return;h=false;CSS.hide(l);CSS.removeClass(document.documentElement,'sidebarMode');j.hide();m.getCore().reset();s.rate('sidebar_hide',i);Arbiter.inform('sidebar/hide',ChatSidebar);}function z(){OrderedFriendsList.subscribe('initialized',function(){var ca=ChatSidebar.shouldShowSidebar();CSS.conditionClass(document.documentElement,'sidebarCapable',ca);if(ChatSidebar.isEnabled()&&ca){CSS.setStyle(l,'height',n.y+'px');aa();var da=n.y;$A(l.childNodes).forEach(function(ea){if(ea!==e)da-=Vector2.getElementDimensions(ea).y;});CSS.setStyle(e,'height',da+'px');this._maxItems=Math.floor((da-8)/t);j.setNumTopFriends(this._maxItems);m.getData().setMaxResults(this._maxItems);Arbiter.inform('sidebar/resized',ChatSidebar);}else y();i=true;});}function aa(){if(ChatSidebar.isVisible())return;h=true;CSS.show(l);CSS.addClass(document.documentElement,'sidebarMode');j.show();s.rate('sidebar_show',i);Arbiter.inform('sidebar/show',ChatSidebar);}function ba(){chatOptions.setSetting('sidebar_mode',ChatSidebar.isEnabled(),'sidebar');new AsyncRequest('/ajax/chat/settings.php').setHandler(bagofholding).setErrorHandler(bagofholding).setData({sidebar_mode:ChatSidebar.isEnabled()}).setAllowCrossPageTransition(true).send();}return {init:function(ca,da,ea){ChatSidebar.init=bagofholding;requireLazy(['ChatConfig','ChannelConnection','ChannelConstants','ChatVisibility','PresencePrivacy'],function(fa,ga,ha,ia,ja){b=fa;c=ga;d=ha;ChatVisibility=ia;PresencePrivacy=ja;if(b.get('mercury_integration'))requireLazy(['ChatBehavior'],function(ka){a=ka;a.subscribe(a.ON_CHANGED,function(){i&&x();});i&&x();});l=ca;j=da;m=ea;e=DOM.find(ca,'div.fbChatSidebarBody');k=DOM.find(ca,'div.fbChatSidebarMessage div.message');da.setScrollContainer(DOM.find(e,'div.uiScrollableAreaWrap'));da.subscribe(['render','show','hide'],debounce(function(){var ka=da.getRoot(),la=ScrollableArea.getInstance(ka);la&&la.adjustGripper();}));ChatQuietLinks.silence(ca);Event.listen(window,'resize',z);Arbiter.subscribe('chat/option-changed',function(ka,la){if(la.name=="sidebar_mode"){f=!!chatOptions.getSetting('sidebar_mode');z();}});ea.subscribe(['respond','reset'],function(ka,la){if(h)if(la&&la.value&&la.value===ea.getCore().getValue()&&ea.getView().isVisible()){j.hide();}else j.show();});ea.getData().subscribe('beforeQuery',z);c.subscribe([c.CONNECTED,c.SHUTDOWN],w);if(b.get('channel_disconnect_warning')){c.subscribe(c.RECONNECTING,w);c.subscribe([c.MUTE_WARNING,c.UNMUTE_WARNING],x);}Arbiter.subscribe('buddylist-nub/initialized',function(ka,la){Event.listen(la.getButton(),'click',function(event){ChatSidebar.enable();return !ChatSidebar.shouldShowSidebar();});});Arbiter.subscribe('chat-options/initialized',function(ka,la){f=!!la.getSetting('sidebar_mode');Arbiter.subscribe('chat-visibility/initialized',function(ma){s.rate('sidebar_vis_init',b.get('blackbird'));x();Arbiter.subscribe('chat/visibility-changed',x);if(b.get('blackbird'))PresencePrivacy.subscribe('privacy-user-presence-changed',x);Arbiter.inform('sidebar/initialized',ChatSidebar,Arbiter.BEHAVIOR_PERSISTENT);});});});},disable:function(){if(!ChatSidebar.isEnabled())return;f=false;ba();y();},enable:function(){if(ChatSidebar.isEnabled())return;f=true;ba();z();!function(){if(ChatSidebar.isVisible())m.getCore().getElement().focus();}.defer();},hide:function(){g=true;y();},unhide:function(){g=false;z();},getBody:function(){return e;},getRoot:function(){return l;},getVisibleWidth:function(){return l&&l.offsetWidth||0;},isEnabled:function(){return f;},isViewportCapable:function(){n=Vector2.getViewportDimensions();return n.x>b.get('sidebar.minimum_width');},shouldShowSidebar:function(){return ChatSidebar.isViewportCapable()&&!g&&OrderedFriendsList.getList().length>b.get('sidebar.min_friends')&&!FbDesktopPlugin.shouldSuppressSidebar();},isVisible:function(){return h;},resize:z,toggle:function(){ChatSidebar.isEnabled()?ChatSidebar.disable():ChatSidebar.enable();}};})();
function VideoEvents(){}Function.mixin(VideoEvents,'Arbiter',{ACTIVATING:'videochat/activating',LOGGING_IN:'videochat/logging_in',GETTING_TOKEN:'videochat/getting_token',CONNECTING:'videochat/connecting',SLOW_CONDITIONS:'videochat/slow_conditions',CALL_INCOMING:'videochat/call_incoming',CALL_CONNECTED:'videochat/call_connected',GOT_CALLEE:'videochat/got_callee',CALL_HANDLED:'videochat/call_handled',CALLEE_ANSWERING:'videochat/callee_answering',FATAL_ERROR:'videochat/fatal_error',CALL_IN_PROGRESS:'videochat/call_in_progress',NOT_AVAILABLE:'videochat/not_available',SERVER_ERROR:'videochat/server_error',ACTIVATE_FAILED:'videochat/activate_failed',ACTIVATE_TIMED_OUT:'videochat/activate_failed_time',WRONG_VERSION_ERROR:'videochat/wrong_version',FATAL_PLUGIN_ERROR:'videochat/plugin_fatality',SILENT_PLUGIN_ERROR:'videochat/plugin_silent_fatality',START_CALL_UI:'videochat/start_call_ui',START_CALL:'videochat/start_call',ANSWER_CALL:'videochat/answer_call',IGNORE_CALL:'videochat/ignore_call',CANCEL_CALL:'videochat/cancel_call',INSTALL_STARTED:'videochat/install_started',INSTALL_COMPLETED:'videochat/install_completed',INSTALL_CANCELED:'videochat/install_canceled',log:function(a){window.console&&console.log&&console.log(a);},warn:function(a){window.console&&console.warn&&console.warn(a);},error:function(a){window.console&&console.error&&console.error(a);}});
var VideoChatPlugin=function(){};Function.mixin(VideoChatPlugin,'Arbiter',{INSTALL_TYPES:{JAVA:0,MANUAL:1},isSupported:function(){var a=ua.windows()&&((ua.ie()>=7&&!ua.ie64())||ua.firefox()>=3.6||ua.chrome()>=5),b=(ua.osx()>10.4)&&(ua.firefox()>=3.6||ua.chrome()>=5||ua.safari()>=500);return (a||b);},notifyFromApplet:function(a,b){Arbiter.inform(String(a),{args:String(b)});},isInstalled:function(){var a=false;if(VideoChatPlugin.isSupported())if(VideoChatPlugin.usesActiveX()){var b=null;try{b=new ActiveXObject('SkypeLimited.SkypeWebPlugin');a=!!b;}catch(c){}b=null;}else a=VideoChatPlugin._getInstalledVersion();return a;},usesActiveX:function(){return ua.ie()&&ua.windows()&&!ua.opera();},setLogger:function(a){VideoChatPlugin.log=a||bagofholding;},embed:function(a){Bootloader.loadComponents('VideoChatPluginCore',function(){VideoChatPlugin.embed(a);});},remove:bagofholding,_getInstalledVersion:function(){if(!navigator)return null;navigator.plugins.refresh(false);mimeHandler=navigator.mimeTypes['application/skypesdk-plugin'];return mimeHandler&&mimeHandler.enabledPlugin;}});
var VideoChatView={RINGTONE_PATH:'/sound/bling.mp3',WINDOW_NAME_COOKIE_KEY:'vcpwn',TARGET_ID_COOKIE_KEY:'vctid',inIncomingCall:false,inOutgoingCall:false,inManualInstall:false,tokens:[],missedCallDialog:null,init:function(){VideoChatView.subscribe(VideoEvents.CALL_INCOMING,VideoChatView._onIncomingCall);VideoChatView.subscribe(VideoEvents.START_CALL_UI,function(a,b){VideoChatView._logClick(b.idTarget,b.clickSource);if(!VideoChatView.inOutgoingCall){VideoChatView.inOutgoingCall=true;if(VideoChatPlugin.isInstalled()){VideoChatView.onOutgoingCall(b.idTarget);}else VideoChatView._invokeCore('promptInstall',b.idTarget);}});if(VideoChatPlugin.isSupported())CSS.addClass(document.documentElement,'videoCallEnabled');onbeforeunloadRegister(function(){if((VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall)&&!VideoChatView.inManualInstall)return "Durch das Verlassen dieser Seite wird dein Anruf beendet.";},false);onunloadRegister(function(){if(VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall){VideoEvents.inform(VideoEvents.CANCEL_CALL,{cause:'leave:page'});VideoChatView.inIncomingCall=false;VideoChatView.inOutgoingCall=false;}});VideoChatView._checkPriorState();},subscribe:function(a,b){VideoChatView.tokens.push(VideoEvents.subscribe(a,b));},onProfileButtonClick:function(a){VideoChatView._invokeCore('onProfileButtonClick',a,'profile_button_click');},startCallOrLeaveMessage:function(a){VideoChatView._invokeCore('onProfileButtonClick',a,'call_or_leave_message');},unload:function(){while(VideoChatView.tokens.length)VideoEvents.unsubscribe(VideoChatView.tokens.pop());},mightReloadPostInstall:function(){return ua.windows();},_logClick:function(a,b){new AsyncRequest().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:a,clickSource:b}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();},_showDialog:function(a,b){new Dialog().setAllowCrossPageTransition(true).setTop(b?85:125).setAsync(new AsyncRequest(a)).show();},_onIncomingCall:function(a,b){VideoChatView.inIncomingCall=true;VideoChatView._logClick(b.idTarget,'incoming_call');VideoChatView._showDialog(URI('/ajax/chat/video/incoming_call.php').setQueryData({idTarget:b.idTarget,callId:b.callId}),true);},onOutgoingCall:function(a){VideoChatView.inOutgoingCall=true;VideoChatView._showDialog('/ajax/chat/video/outgoing_call.php?idTarget='+a);},onMissedCall:function(a){var b='/ajax/chat/video/missed_call.php?idTarget='+a,c=new Dialog().setAsync(new AsyncRequest(b));if(!(VideoChatView.inOutgoingCall||VideoChatView.inIncomingCall)){c.show();}else VideoChatView.missedCallDialog=c;},_checkPriorState:function(){if(VideoChatView.mightReloadPostInstall()){var a=getCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);if(a){clearCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);var b=getCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(b){clearCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(getCookie(VideoChatView.TARGET_ID_COOKIE_KEY))return;if(VideoChatPlugin.isInstalled())VideoChatView.onOutgoingCall(b);}}}},_invokeCore:function(a){var b=Array.prototype.slice.call(arguments,1);Bootloader.loadComponents('VideoChatViewCore',function(){VideoChatView.initCore();VideoChatView[a].apply(VideoChatView,b);});}};
function PresenceIndicator(){}copy_properties(PresenceIndicator.prototype,{init:function(a,b,c){this._id=a;this._firstname=b;this._tooltip=c;this._image=DOM.scry(this._tooltip,'i')[0];this._previousAvail=null;this._jslog=JSLogger.create('presence_indicator');Arbiter.subscribe('chat-visibility/initialized',function(e){this._jslog.log('vis_init',e);this._updateVisibility();}.bind(this));this._subscriptions=[Arbiter.subscribe([AvailableListConstants.ON_AVAILABILITY_CHANGED],this._updateAvailability.bind(this)),Arbiter.subscribe(['chat/visibility-changed'],this._updateVisibility.bind(this))];this._updateAvailability.bind(this).defer();var d=Event.listen(this._tooltip,'click',function(){requireLazy(['AvailableList'],function(e){if(this._previousAvail!=AvailableListConstants.OFFLINE)Chat.openTab(this._id);}.bind(this));}.bind(this));onleaveRegister(function(){d.remove();while(this._subscriptions.length)Arbiter.unsubscribe(this._subscriptions.pop());}.bind(this));},_updateAvailability:function(){requireLazy(['AvailableList','ChatConfig'],function(a,b){if(!a.isReady())return;var c,d,e=a.get(this._id);if(e===this._previousAvail)return;this._previousAvail=e;switch(e){case AvailableListConstants.OFFLINE:c=b.get('blackbird')?tx._("{name} ist offline.",{name:this._firstname}):tx._("{name} ist nicht verf\u00fcgbar",{name:this._firstname});d='offline';break;case AvailableListConstants.IDLE:c=tx._("{name} ist inaktiv",{name:this._firstname});d='idle';break;case AvailableListConstants.ACTIVE:c=b.get('blackbird')?tx._("{name} ist online",{name:this._firstname}):tx._("{name} ist verf\u00fcgbar",{name:this._firstname});d='online';break;case AvailableListConstants.MOBILE:c=tx._("{name} ist auf dem Handy erreichbar",{name:this._firstname});d='mobile';break;default:throw new Error('Invalid availability');}TooltipLink.setTooltipText(this._tooltip,c);CSS.setClass(this._image,d);}.bind(this));},_updateVisibility:function(){requireLazy(['ChatVisibility'],function(a){if(a.isOnline()){CSS.show(this._tooltip);}else CSS.hide(this._tooltip);}.bind(this));}});